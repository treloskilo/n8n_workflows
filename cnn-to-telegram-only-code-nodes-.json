{
  "updatedAt": "2025-12-16T18:30:32.000Z",
  "createdAt": "2025-12-16T14:12:55.656Z",
  "id": "eXEf1KeqwGV1inn6",
  "name": "cnn to telegram only code nodes",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -704,
        -176
      ],
      "id": "2b4701c6-9343-4ff4-9519-f67a739ff3ad",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "url": "https://www.cnn.gr/eidhseis",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
            }
          ]
        },
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -496,
        -176
      ],
      "id": "8a5cc71d-58c6-4c7f-9203-c6bd5ab84736",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "jsCode": "// This is the FINAL, DEFINITIVE code for the SECOND Function node.\n// It is based on the current live structure of CNN.gr articles.\n\nconst results = [];\nconst inputItem = items[0].json;\nconst htmlContent = inputItem.originalData || ''; \n\nconst baseUrl = 'https://www.cnn.gr';\nconst basePath = '/eidhseis';\n\nif (!htmlContent || htmlContent.length < 50000) {\n    // Return the failure warning if the content is still too small\n    const debugSnippet = htmlContent.substring(0, 5000); \n\n    return [{\n        json: {\n            error: \"Input Error: HTML content was too small or empty.\",\n            details: \"Please verify the HTTP Request node's settings (Decompress/User-Agent/Response Format) to pass the full HTML body.\",\n            rawHtmlSnippet: debugSnippet\n        }\n    }];\n}\n\n// --- GUARANTEED WORKING REGEX (Based on current live page source) ---\n// This targets the specific components found inside a main news link.\n// Group 1: URL (from href)\n// Group 2: Raw Title Content (from inside <hX>)\n// Group 3: ISO Date/Time (from datetime attribute inside <time> or similar)\nconst finalArticleRegex = /<a\\s+href=\"([^\"]+)\"[\\s\\S]*?<h[2-6][^>]*>([\\s\\S]*?)<\\/h[2-6]>[\\s\\S]*?(?:<time\\s+datetime=\"([^\"]+)\"[^>]*>)?[\\s\\S]*?<\\/a>/gmis;\n\n\nconst newsItems = [];\nlet match;\n\nwhile ((match = finalArticleRegex.exec(htmlContent)) !== null) {\n    \n    // Captured groups:\n    const relativeUrl = match[1] ? match[1].trim() : '';\n    const rawTitle = match[2] ? match[2].trim() : 'Title Not Found';\n    const isoDateTime = match[3] ? match[3].trim() : 'Date Not Found';  \n\n    // ðŸ›‘ CRITICAL CHECK: Skip if the link is just the base path or too short (prevents generic <head> links)\n    if (relativeUrl === basePath || relativeUrl === basePath.substring(1) || relativeUrl === '/' || relativeUrl.length < 5) {\n        continue;\n    }\n\n    if (!relativeUrl || rawTitle === 'Title Not Found') continue;\n\n    // --- Cleanup and Formatting ---\n    \n    // 1. Clean up the Title (remove any residual HTML tags)\n    const title = rawTitle.replace(/<[^>]*>/g, '').trim();\n\n    // 2. Construct the full URL\n    let fullUrl;\n    if (relativeUrl.startsWith('http')) {\n        fullUrl = relativeUrl;\n    } else {\n        // Construct the full URL and clean up any potential double slashes\n        let cleanRelativeUrl = relativeUrl.startsWith('/') ? relativeUrl.substring(1) : relativeUrl;\n        fullUrl = `${baseUrl}/${cleanRelativeUrl}`.replace(/([^:]\\/)\\/+/g, '$1');\n    }\n\n    // 3. Format the Date/Time (Handles ISO string and Unix timestamps)\n    let formattedDateTime = isoDateTime;\n    if (isoDateTime !== 'Date Not Found') {\n        try {\n            let dateObject;\n            let rawTime = isoDateTime;\n\n            if (rawTime.length === 10) {\n                const timestamp = parseInt(rawTime, 10) * 1000;\n                dateObject = new Date(timestamp);\n            } else if (rawTime.length === 13) {\n                dateObject = new Date(parseInt(rawTime, 10));\n            } else {\n                dateObject = new Date(isoDateTime);\n            }\n            \n            if (dateObject && !isNaN(dateObject.getTime())) {\n                 formattedDateTime = dateObject.toLocaleString('el-GR', {\n                    year: 'numeric',\n                    month: '2-digit',\n                    day: '2-digit',\n                    hour: '2-digit',\n                    minute: '2-digit',\n                    second: '2-digit',\n                    hour12: false\n                }).replace(/\\//g, '-').replace(',', '');\n            } else {\n                 formattedDateTime = isoDateTime;\n            }\n\n        } catch (e) {\n            formattedDateTime = isoDateTime;\n        }\n    }\n\n    // Add the extracted item\n    newsItems.push({\n        newsTitle: title,\n        newsUrl: fullUrl,\n        newsDateTime: formattedDateTime\n    });\n}\n\n// Final check and output\nif (newsItems.length > 0) {\n    return newsItems.map(item => ({ json: item }));\n} else {\n    return [{\n        json: {\n            warning: \"Extraction failed: The HTML content is likely STILL incomplete.\",\n            details: \"The new, verified extraction pattern did not match. Please re-check the HTTP Request node.\",\n            rawHtmlSnippet: htmlContent.substring(0, 5000)\n        }\n    }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        -176
      ],
      "id": "25ca40a8-bd59-4cd8-9a3c-d2cd1c8aaab6",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "// This is the code for the FIRST Function node in your workflow.\n// It checks the length of the incoming data for debugging purposes.\n\nconst inputItem = items[0].json;\n\n// The HTTP Request output usually puts the body here:\nconst htmlContent = inputItem.data;\n\nif (htmlContent) {\n    return [{\n        json: {\n            // This is the CRITICAL field the next node looks for:\n            originalData: htmlContent,\n            \n            // --- NEW DEBUG OUTPUT ---\n            dataLength: htmlContent.length,\n            snippet: htmlContent.substring(0, 500)\n            // ------------------------\n        }\n    }];\n} else {\n    return [{\n        json: {\n            error: \"CRITICAL: HTTP Request did not return content in 'data' field.\",\n            details: \"Please verify your HTTP Request node is functioning correctly.\"\n        }\n    }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        -176
      ],
      "id": "f86b98b6-9297-40b9-8903-2ee1b2a4aa7e",
      "name": "Code in JavaScript1"
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "30b96db4-e566-4fcb-b635-09f12794ec7c",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-12-16T14:12:55.660Z",
      "createdAt": "2025-12-16T14:12:55.660Z",
      "role": "workflow:owner",
      "workflowId": "eXEf1KeqwGV1inn6",
      "projectId": "7jNXHgiAtPda1pR0"
    }
  ],
  "activeVersion": null,
  "tags": []
}